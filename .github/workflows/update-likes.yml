name: Update Likes

on:
  workflow_dispatch:
    inputs:
      post:
        description: 'Blog post ID'
        required: true
        default: 'jwt-vs-oauth2'

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Update likes count
        run: |
          FILE="data/likes.json"
          POST="${{ github.event.inputs.post }}"
          COUNT=$(jq ".\"$POST\"" $FILE)
          NEW_COUNT=$((COUNT + 1))
          jq ".\"$POST\" = $NEW_COUNT" $FILE > tmp.json && mv tmp.json $FILE

      - name: Commit changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add data/likes.json
          git commit -m "Increment like for ${{ github.event.inputs.post }}"
          git push
